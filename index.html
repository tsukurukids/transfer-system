<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>振替申請 - ツクール</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; margin-top: 30vh; color: #333; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #06C755; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="spinner"></div>
    <p>振替申請フォームを準備しています...<br>少々お待ちください</p>

    <script>
        // --- 設定エリア ---
        const LIFF_ID = "2009156481-8H1NbFct"; 
        const FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdlUS6ZfRqFOaJ8t8jYf7VqbXwKorhTdxukCha9eaudxxpT5g/viewform?usp=pp_url&entry.131182360=DUMMY"; 
        // ----------------

        document.addEventListener("DOMContentLoaded", () => {
            liff.init({ liffId: LIFF_ID })
                .then(() => {
                    if (!liff.isLoggedIn()) {
                        liff.login();
                        return;
                    }
                    return liff.getProfile();
                })
                .then(profile => {
                    if (profile && profile.userId) {
                        // URLの中の「DUMMY」を実際のLINE IDに置き換えてジャンプ！
                        const finalUrl = FORM_URL.replace("DUMMY", profile.userId);
                        window.location.replace(finalUrl); 
                    }
                })
                .catch(err => {
                    console.error("LIFF Error:", err);
                    document.body.innerHTML = "<p>エラーが発生しました。公式LINEから開き直してください。</p>";
                });
        });
    </script>
</body>
</html>
